<!DOCTYPE html>
<html lang="th">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>à¸£à¸°à¸šà¸šà¸ªà¸³à¸£à¸§à¸ˆà¸„à¸°à¹à¸™à¸™ Pre-test à¸ªà¸•à¸£à¸µà¸§à¸´à¸—à¸¢à¸² à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² 2569</title>
Â  Â  
Â  Â  Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  
Â  Â  Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;500;600;700&display=swap" rel="stylesheet">
Â  Â  
Â  Â  Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

Â  Â  <style>
Â  Â  Â  Â  body { font-family: 'Noto Sans Thai', sans-serif; background-color: #f7f8fc; }
Â  Â  Â  Â  .header-gradient { background-image: linear-gradient(135deg, #2a2a72 0%, #009ffd 100%); }
Â  Â  Â  Â  .input-field {
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem; padding: 0.75rem 1rem; border: 1px solid #d1d5db;
Â  Â  Â  Â  Â  Â  transition: border-color 0.2s, box-shadow 0.2s; background-color: #f9fafb;
Â  Â  Â  Â  }
Â  Â  Â  Â  .input-field:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); outline: none; }
Â  Â  Â  Â  .btn {
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem; transition: all 0.2s ease; color: white; font-weight: 600;
Â  Â  Â  Â  Â  Â  padding: 0.75rem 1.5rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  Â  Â  border: none; cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-primary { background-image: linear-gradient(to right, #3b82f6, #60a5fa); }
Â  Â  Â  Â  .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 7px 20px rgba(59, 130, 246, 0.2); }
Â  Â  Â  Â  .btn-secondary { background-image: linear-gradient(to right, #6b7280, #9ca3af); }
Â  Â  Â  Â  .btn-secondary:hover { transform: translateY(-2px); box-shadow: 0 7px 20px rgba(107, 114, 128, 0.2); }
Â  Â  Â  Â  .btn-success { background-image: linear-gradient(to right, #16a34a, #22c55e); }
Â  Â  Â  Â  .btn-success:hover { transform: translateY(-2px); box-shadow: 0 7px 20px rgba(22, 163, 74, 0.2); }
Â  Â  Â  Â  .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
Â  Â  Â  Â  th { background-color: #f3f4f6; }
Â  Â  Â  Â  .tab-button {
Â  Â  Â  Â  Â  Â  padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600;
Â  Â  Â  Â  Â  Â  cursor: pointer; transition: all 0.2s; border: 2px solid transparent;
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-button.active {
Â  Â  Â  Â  Â  Â  background-color: #e0e7ff; color: #4338ca; border-color: #a5b4fc;
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-button:not(.active) { color: #4b5563; background-color: #f9fafb; }
Â  Â  Â  Â  #admin-section { display: none; } /* Hide admin by default */
Â  Â  </style>
</head>
<body class="p-4 sm:p-6">

Â  Â  <div id="loading-overlay" class="fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50 hidden backdrop-blur-sm">
Â  Â  Â  Â  <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500"></div>
Â  Â  </div>
Â  Â  
Â  Â  <div id="message-box" class="fixed top-5 right-5 z-50 w-80"></div>
Â  Â  <div id="modal-box" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50"></div>

Â  Â  Â  Â  <div class="max-w-7xl mx-auto text-center py-3 mb-4 bg-pink-100 rounded-xl shadow-md border-2 border-pink-300">
Â  Â  Â  Â  <h2 class="text-2xl font-extrabold text-pink-700 tracking-wider">
Â  Â  Â  Â  Â  Â  à¸„à¸£à¸­à¸šà¸„à¸£à¸±à¸§à¸¢à¸­à¸”à¸™à¸²à¸£à¸µ â¤ï¸ à¸ªà¸•à¸£à¸µà¸§à¸´à¸—à¸¢à¸²
Â  Â  Â  Â  </h2>
Â  Â  </div>
Â  Â  Â  Â  <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
Â  Â  Â  Â  <header class="text-center p-8 sm:p-10 header-gradient relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="back-to-form-btn" class="absolute top-4 left-4 btn btn-secondary text-sm hidden" onclick="switchView('form')">
Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-arrow-left mr-1"></i> à¸à¸¥à¸±à¸šà¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <h1 class="text-3xl sm:text-4xl font-extrabold text-white leading-tight">
Â  Â  Â  Â  Â  Â  Â  Â  à¸£à¸°à¸šà¸šà¸ªà¸³à¸£à¸§à¸ˆà¸„à¸°à¹à¸™à¸™ Pre-test à¸ªà¸•à¸£à¸µà¸§à¸´à¸—à¸¢à¸²
Â  Â  Â  Â  Â  Â  </h1>
Â  Â  Â  Â  Â  Â  <p class="text-lg text-blue-200 mt-2">à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² 2569</p>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <main class="p-6 sm:p-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-center border-b mb-8 space-x-2 sm:space-x-4">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="tab-form" class="tab-button active" onclick="switchView('form')"><i class="fas fa-edit mr-2"></i>à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="tab-results" class="tab-button" onclick="switchView('results')"><i class="fas fa-chart-bar mr-2"></i>à¸”à¸¹à¸œà¸¥à¸ªà¸³à¸£à¸§à¸ˆ</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="form-section">
Â  Â  Â  Â  Â  Â  Â  Â  <form id="survey-form" class="space-y-8 max-w-2xl mx-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="nickname" class="block text-gray-700 font-semibold mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™ / à¸™à¸²à¸¡à¹à¸à¸‡ (à¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸ªà¸”à¸‡à¸œà¸¥ - à¹„à¸¡à¹ˆà¸šà¸±à¸‡à¸„à¸±à¸š)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="nickname" class="input-field w-full" placeholder="à¹€à¸Šà¹ˆà¸™ à¸™à¹‰à¸­à¸‡à¸¢à¸­à¸”à¸™à¸²à¸£à¸µ à¸«à¸£à¸·à¸­à¸›à¸¥à¹ˆà¸­à¸¢à¸§à¹ˆà¸²à¸‡à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹€à¸›à¸´à¸”à¹€à¸œà¸¢à¸Šà¸·à¹ˆà¸­">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="curriculum" class="block text-gray-700 font-semibold mb-2">à¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£à¸—à¸µà¹ˆà¸ªà¸­à¸š</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="curriculum" class="input-field w-full" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="" disabled selected>-- à¹€à¸¥à¸·à¸­à¸à¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£ --</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="EP">EP</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="GM">GM</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="SMTE">SMTE</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Normal">à¸«à¹‰à¸­à¸‡à¹€à¸£à¸µà¸¢à¸™à¸›à¸à¸•à¸´</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="examType" class="block text-gray-700 font-semibold mb-2">à¸›à¸£à¸°à¹€à¸ à¸—à¸à¸²à¸£à¸ªà¸­à¸š</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="examType" class="input-field w-full" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="On-site">On-site</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Online">Online</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="score-inputs" class="space-y-4 pt-4 border-t">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-semibold text-lg text-gray-800">à¸à¸£à¸­à¸à¸„à¸°à¹à¸™à¸™à¹à¸¥à¸°à¸­à¸±à¸™à¸”à¸±à¸š</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center pt-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-primary w-full md:w-auto text-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-paper-plane mr-2"></i> à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="results-section" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 text-blue-800">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-info-circle mr-2"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™à¸•à¸²à¸£à¸²à¸‡à¸ˆà¸°à¸­à¸±à¸›à¹€à¸”à¸•à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µà¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸‚à¹‰à¸²à¸¡à¸²à¹ƒà¸«à¸¡à¹ˆ
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="filter-curriculum" class="input-field w-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="all">à¸—à¸¸à¸à¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="EP">EP</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="GM">GM</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="SMTE">SMTE</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Normal">à¸«à¹‰à¸­à¸‡à¹€à¸£à¸µà¸¢à¸™à¸›à¸à¸•à¸´</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="filter-examType" class="input-field w-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="all">à¸—à¸¸à¸à¸›à¸£à¸°à¹€à¸ à¸—à¸à¸²à¸£à¸ªà¸­à¸š</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="On-site">On-site</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Online">Online</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="table-container border rounded-lg shadow-md">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table class="w-full text-sm text-left text-gray-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead class="text-xs text-gray-700 uppercase">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th scope="col" class="py-3 px-4">à¸­à¸±à¸™à¸”à¸±à¸š</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th scope="col" class="py-3 px-4">à¸Šà¸·à¹ˆà¸­</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th scope="col" class="py-3 px-4">à¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th scope="col" class="py-3 px-4">à¸›à¸£à¸°à¹€à¸ à¸—à¸ªà¸­à¸š</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th scope="col" class="py-3 px-4 text-right">à¸„à¸°à¹à¸™à¸™à¸£à¸§à¸¡</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="results-table-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr><td colspan="5" class="text-center py-6 text-gray-500">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥...</td></tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â Â  Â  Â  Â  Â  Â  <div id="admin-section" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 text-gray-800">Admin Panel - à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="export-csv" class="btn btn-success mb-6"><i class="fas fa-file-excel mr-2"></i>Export to CSV (Excel)</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="table-container border rounded-lg shadow-md">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table class="w-full text-sm text-left text-gray-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead id="admin-table-head" class="text-xs text-gray-700 uppercase">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="admin-table-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </main>
Â  Â  </div>
Â  Â  
Â  Â  <footer class="text-center py-6 text-gray-500 text-sm">
Â  Â  Â  Â  <p>Developed for Satriwitthaya Pre-test Takers</p>
Â  Â  Â  Â  <a href="#" id="admin-login" class="text-blue-600 hover:underline">Admin Login</a>
Â  Â  </footer>
Â  Â  
Â  Â  Â  Â  <script type="module">
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
Â  Â  Â  Â  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
Â  Â  Â  Â  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
Â  Â  Â  Â  
Â  Â  Â  Â  // --- à¸ªà¹ˆà¸§à¸™à¸ªà¸³à¸„à¸±à¸: Firebase Configuration ---
Â  Â  Â  Â  // à¹€à¸¡à¸·à¹ˆà¸­à¸£à¸±à¸™à¸šà¸™ GitHub Pages, à¸•à¸±à¸§à¹à¸›à¸£ __firebase_config à¸ˆà¸°à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¹ˆà¸²
Â  Â  Â  Â  // **à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸§à¸²à¸‡ JSON object à¸‚à¸­à¸‡ Firebase config à¸—à¸µà¹ˆà¸™à¸µà¹ˆ**
Â  Â  Â  Â  // à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡: '{"apiKey": "AIzaSy...", "authDomain": "...", "projectId": "..."}'
Â  Â  Â  Â  const externalConfigJson = '{"apiKey": "AIzaSyAArg_514dJWcc73vHG-a1ngSxa4e_Kw1Y", "authDomain": "satriwit-pretest-2569.firebaseapp.com", "projectId": "satriwit-pretest-2569", "storageBucket": "satriwit-pretest-2569.firebasestorage.app", "messagingSenderId": "474635724481", "appId": "1:474635724481:web:b236a9a88b47bcdd5c1640", "measurementId": "G-9CD7MKHG7K"}';

Â  Â  Â  Â  let firebaseConfig;
Â  Â  Â  Â  
Â  Â  Â  Â  // 1. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µà¸à¸²à¸£à¸ªà¹ˆà¸‡ config à¸œà¹ˆà¸²à¸™ environment variable à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ (à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸£à¸±à¸™à¹ƒà¸™ Canvas)
Â  Â  Â  Â  if (typeof __firebase_config !== 'undefined' && __firebase_config) {
Â  Â  Â  Â  Â  Â  try { firebaseConfig = JSON.parse(__firebase_config); } catch(e) { firebaseConfig = {}; }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // 2. à¸«à¸²à¸à¹„à¸¡à¹ˆà¸¡à¸µ à¹ƒà¸«à¹‰à¹ƒà¸Šà¹‰ config à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹ƒà¸ªà¹ˆà¹€à¸­à¸‡ (à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸£à¸±à¸™à¸šà¸™ GitHub Pages/Local)
Â  Â  Â  Â  if (!firebaseConfig?.projectId && externalConfigJson !== 'YOUR_FIREBASE_CONFIG_JSON_HERE') {
Â  Â  Â  Â  Â  Â  try { firebaseConfig = JSON.parse(externalConfigJson); } catch(e) { firebaseConfig = {}; }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Global Variables ---
Â  Â  Â  Â  let db;
Â  Â  Â  Â  let auth;
Â  Â  Â  Â  let allScores = []; // Cache for all scores from Firestore
Â  Â  Â  Â  const adminPassword = "@E12345@e"; 

Â  Â  Â  Â  // à¸à¸³à¸«à¸™à¸”à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸§à¸´à¸Šà¸²à¹à¸¥à¸°à¸„à¸°à¹à¸™à¸™à¹€à¸•à¹‡à¸¡à¸•à¸²à¸¡à¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£
Â  Â  Â  Â  const subjectConfig = {
Â  Â  Â  Â  Â  Â  Special: [
Â  Â  Â  Â  Â  Â  Â  Â  { name: 'Math', max: 50 }, 
Â  Â  Â  Â  Â  Â  Â  Â  { name: 'Science', max: 30 }, 
Â  Â  Â  Â  Â  Â  Â  Â  { name: 'English', max: 30 }
Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Normal: [
Â  Â  Â  Â  Â  Â  Â  Â  { name: 'Math', max: 30 }, 
Â  Â  Â  Â  Â  Â  Â  Â  { name: 'Science', max: 30 }, 
Â  Â  Â  Â  Â  Â  Â  Â  { name: 'English', max: 30 }, 
Â  Â  Â  Â  Â  Â  Â  Â  { name: 'Thai', max: 30 }, 
Â  Â  Â  Â  Â  Â  Â  Â  { name: 'Social', max: 30 }
Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  };
Â  Â  Â  Â  // à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­à¸§à¸´à¸Šà¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸Šà¹‰à¹ƒà¸™à¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡ Header à¸‚à¸­à¸‡à¸•à¸²à¸£à¸²à¸‡ Admin/CSV
Â  Â  Â  Â  const allSubjects = ['Math', 'Science', 'English', 'Thai', 'Social'];


Â  Â  Â  Â  // --- UI Element References ---
Â  Â  Â  Â  const curriculumSelect = document.getElementById('curriculum');
Â  Â  Â  Â  const scoreInputsDiv = document.getElementById('score-inputs').querySelector('div');
Â  Â  Â  Â  const form = document.getElementById('survey-form');
Â  Â  Â  Â  const filterCurriculum = document.getElementById('filter-curriculum');
Â  Â  Â  Â  const filterExamType = document.getElementById('filter-examType');
Â  Â  Â  Â  
Â  Â  Â  Â  // --- Core Functions ---
Â  Â  Â  Â  
Â  Â  Â  Â  // Initialize Firebase and Auth
Â  Â  Â  Â  async function initializeFirebase() {
Â  Â  Â  Â  Â  Â  if (!firebaseConfig || !firebaseConfig.apiKey) {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸à¸£à¸¸à¸“à¸²à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Firebase Config à¹ƒà¸™à¹‚à¸„à¹‰à¸”à¸à¹ˆà¸­à¸™à¹ƒà¸Šà¹‰à¸‡à¸²à¸™", "error");
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('results-table-body').innerHTML = `<tr><td colspan="5" class="text-center py-6 text-red-500">Firebase Config à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ à¸à¸£à¸¸à¸“à¸²à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸².</td></tr>`;
Â  Â  Â  Â  Â  Â  Â  Â  return; 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  Â  Â  Â  Â  db = getFirestore(app);
Â  Â  Â  Â  Â  Â  Â  Â  auth = getAuth(app);
Â  Â  Â  Â  Â  Â  Â  Â  await signInAnonymously(auth);
Â  Â  Â  Â  Â  Â  Â  Â  console.log("Firebase initialized and user signed in anonymously.");
Â  Â  Â  Â  Â  Â  Â  Â  fetchAndDisplayScores();
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Firebase initialization failed:", error);
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰", "error");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Custom Modal for confirmations/prompts (replacing alert/prompt)
Â  Â  Â  Â  function customPrompt(message, callback) {
Â  Â  Â  Â  Â  Â  const modalBox = document.getElementById('modal-box');
Â  Â  Â  Â  Â  Â  modalBox.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white p-6 rounded-xl shadow-2xl w-80">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-lg font-medium text-gray-800 mb-4">${message}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="modal-input" class="input-field w-full mb-4" placeholder="à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™" autocomplete="off">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end space-x-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="modal-cancel" class="btn btn-secondary text-sm">à¸¢à¸à¹€à¸¥à¸´à¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="modal-confirm" class="btn btn-primary text-sm">à¸•à¸à¸¥à¸‡</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  modalBox.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  modalBox.classList.add('flex');

Â  Â  Â  Â  Â  Â  document.getElementById('modal-confirm').onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  const password = document.getElementById('modal-input').value;
Â  Â  Â  Â  Â  Â  Â  Â  modalBox.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  modalBox.classList.remove('flex');
Â  Â  Â  Â  Â  Â  Â  Â  callback(password);
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  document.getElementById('modal-cancel').onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  modalBox.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  modalBox.classList.remove('flex');
Â  Â  Â  Â  Â  Â  Â  Â  callback(null);
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  document.getElementById('modal-input').focus();
Â  Â  Â  Â  }

Â  Â  Â  Â  // Switch between Form, Results, and Admin view
Â  Â  Â  Â  window.switchView = (view) => {
Â  Â  Â  Â  Â  Â  const formSection = document.getElementById('form-section');
Â  Â  Â  Â  Â  Â  const resultsSection = document.getElementById('results-section');
Â  Â  Â  Â  Â  Â  const adminSection = document.getElementById('admin-section');
Â  Â  Â  Â  Â  Â  const tabForm = document.getElementById('tab-form');
Â  Â  Â  Â  Â  Â  const tabResults = document.getElementById('tab-results');
Â  Â  Â  Â  Â  Â  const backBtn = document.getElementById('back-to-form-btn'); // Added back button reference

Â  Â  Â  Â  Â  Â  // Hide all
Â  Â  Â  Â  Â  Â  formSection.classList.add('hidden');
Â  Â  Â  Â  Â  Â  resultsSection.classList.add('hidden');
Â  Â  Â  Â  Â  Â  adminSection.classList.add('hidden');
Â  Â  Â  Â  Â  Â  tabForm.classList.remove('active');
Â  Â  Â  Â  Â  Â  tabResults.classList.remove('active');
Â  Â  Â  Â  Â  Â  backBtn.classList.add('hidden'); // Hide back button by default

Â  Â  Â  Â  Â  Â  // Show selected view
Â  Â  Â  Â  Â  Â  if(view === 'form') {
Â  Â  Â  Â  Â  Â  Â  Â  formSection.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  tabForm.classList.add('active');
Â  Â  Â  Â  Â  Â  } else if (view === 'results') {
Â  Â  Â  Â  Â  Â  Â  Â  resultsSection.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  tabResults.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  backBtn.classList.remove('hidden'); // Show back button
Â  Â  Â  Â  Â  Â  Â  Â  applyFilters();
Â  Â  Â  Â  Â  Â  } else if (view === 'admin') {
Â  Â  Â  Â  Â  Â  Â  Â  adminSection.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  backBtn.classList.remove('hidden'); // Show back button
Â  Â  Â  Â  Â  Â  Â  Â  // Do not mark a tab active for admin view
Â  Â  Â  Â  Â  Â  Â  Â  renderAdminTable(allScores);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â  
Â  Â  Â  Â  // Generate score input fields based on curriculum (UPDATED)
Â  Â  Â  Â  function updateScoreInputs() {
Â  Â  Â  Â  Â  Â  const selectedCurriculum = curriculumSelect.value;
Â  Â  Â  Â  Â  Â  // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¹€à¸›à¹‡à¸™à¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£à¸à¸´à¹€à¸¨à¸©à¸«à¸£à¸·à¸­à¸›à¸à¸•à¸´
Â  Â  Â  Â  Â  Â  const type = (selectedCurriculum === 'Normal') ? 'Normal' : 'Special';
Â  Â  Â  Â  Â  Â  // subjects à¹€à¸›à¹‡à¸™ Array à¸‚à¸­à¸‡ Object à¸—à¸µà¹ˆà¸¡à¸µ {name, max}
Â  Â  Â  Â  Â  Â  const subjects = subjectConfig[type] || [];
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  scoreInputsDiv.innerHTML = ''; // Clear previous fields
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // à¸ªà¸£à¹‰à¸²à¸‡ Field Input à¸à¸£à¹‰à¸­à¸¡à¸à¸³à¸«à¸™à¸” Max Score à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡
Â  Â  Â  Â  Â  Â  subjects.forEach(subject => {
Â  Â  Â  Â  Â  Â  Â  Â  const inputDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  inputDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="score_${subject.name}" class="block text-gray-700 text-sm font-medium mb-1">${subject.name} (à¹€à¸•à¹‡à¸¡ ${subject.max})</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="score_${subject.name}" data-subject="${subject.name}" class="input-field w-full" placeholder="à¸„à¸°à¹à¸™à¸™" required min="0" max="${subject.max}" step="0.01">
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  scoreInputsDiv.appendChild(inputDiv);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Add Rank input field
Â  Â  Â  Â  Â  Â  const rankDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  rankDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <label for="rank" class="block text-gray-700 text-sm font-medium mb-1">à¸­à¸±à¸™à¸”à¸±à¸šà¸—à¸µà¹ˆ</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="rank" class="input-field w-full" placeholder="à¸­à¸±à¸™à¸”à¸±à¸šà¸—à¸µà¹ˆà¹„à¸”à¹‰" required min="1">
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  scoreInputsDiv.appendChild(rankDiv);
Â  Â  Â  Â  }

Â  Â  Â  Â  // Handle form submission
Â  Â  Â  Â  async function handleFormSubmit(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  toggleLoading(true);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (!db) {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™", "error");
Â  Â  Â  Â  Â  Â  Â  Â  toggleLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const scores = {};
Â  Â  Â  Â  Â  Â  let totalScore = 0;
Â  Â  Â  Â  Â  Â  let isValid = true;

Â  Â  Â  Â  Â  Â  // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹à¸¥à¸°à¸£à¸§à¸¡à¸„à¸°à¹à¸™à¸™
Â  Â  Â  Â  Â  Â  document.querySelectorAll('#score-inputs input[data-subject]').forEach(input => {
Â  Â  Â  Â  Â  Â  Â  Â  const score = parseFloat(input.value);
Â  Â  Â  Â  Â  Â  Â  Â  const max = parseFloat(input.max);

Â  Â  Â  Â  Â  Â  Â  Â  if (score > max) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`à¸„à¸°à¹à¸™à¸™ ${input.dataset.subject} à¸•à¹‰à¸­à¸‡à¹„à¸¡à¹ˆà¹€à¸à¸´à¸™ ${max}`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isValid = false;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  scores[input.dataset.subject] = score;
Â  Â  Â  Â  Â  Â  Â  Â  totalScore += score;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (!isValid) {
Â  Â  Â  Â  Â  Â  Â  Â  toggleLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }


Â  Â  Â  Â  Â  Â  const nicknameInput = document.getElementById('nickname').value.trim();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const submissionData = {
Â  Â  Â  Â  Â  Â  Â  Â  // à¸–à¹‰à¸² nickname à¸§à¹ˆà¸²à¸‡ à¹ƒà¸«à¹‰à¹ƒà¸Šà¹‰ 'à¸œà¸¹à¹‰à¹„à¸¡à¹ˆà¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œà¸­à¸­à¸à¸™à¸²à¸¡' à¹à¸—à¸™
Â  Â  Â  Â  Â  Â  Â  Â  nickname: nicknameInput || 'à¸œà¸¹à¹‰à¹„à¸¡à¹ˆà¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œà¸­à¸­à¸à¸™à¸²à¸¡',
Â  Â  Â  Â  Â  Â  Â  Â  curriculum: document.getElementById('curriculum').value,
Â  Â  Â  Â  Â  Â  Â  Â  examType: document.getElementById('examType').value,
Â  Â  Â  Â  Â  Â  Â  Â  rank: parseInt(document.getElementById('rank').value),
Â  Â  Â  Â  Â  Â  Â  Â  scores: scores,
Â  Â  Â  Â  Â  Â  Â  Â  totalScore: totalScore,
Â  Â  Â  Â  Â  Â  Â  Â  createdAt: new Date()
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // à¹ƒà¸Šà¹‰ collection à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™ Public Data à¸•à¸²à¸¡à¸‚à¹‰à¸­à¸à¸³à¸«à¸™à¸”
Â  Â  Â  Â  Â  Â  Â  Â  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
Â  Â  Â  Â  Â  Â  Â  Â  const collectionPath = `artifacts/${appId}/public/data/scores_2569`;

Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, collectionPath), submissionData);
Â  Â  Â  Â  Â  Â  Â  Â  // UPDATED Success Message
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¹€à¸£à¹‡à¸ˆ! à¸‚à¸­à¸šà¸„à¸¸à¸“à¸—à¸µà¹ˆà¸ªà¸¥à¸°à¹€à¸§à¸¥à¸²à¹ƒà¸™à¸à¸²à¸£à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ ğŸ™à¸«à¸§à¸±à¸‡à¹€à¸›à¹‡à¸™à¸­à¸¢à¹ˆà¸²à¸‡à¸¢à¸´à¹ˆà¸‡à¸§à¹ˆà¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸™à¸µà¹‰à¸ˆà¸°à¹€à¸›à¹‡à¸™à¸›à¸£à¸°à¹‚à¸¢à¸Šà¸™à¹Œà¸•à¹ˆà¸­à¸—à¸¸à¸à¸—à¹ˆà¸²à¸™", "success");
Â  Â  Â  Â  Â  Â  Â  Â  form.reset();
Â  Â  Â  Â  Â  Â  Â  Â  updateScoreInputs();
Â  Â  Â  Â  Â  Â  Â  Â  switchView('results'); // Switch to results after successful submission
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error adding document: ", error);
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥: à¹‚à¸›à¸£à¸”à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹à¸¥à¸° Security Rules", "error");
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  toggleLoading(false);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // Fetch data from Firestore in real-time
Â  Â  Â  Â  function fetchAndDisplayScores() {
Â  Â  Â  Â  Â  Â  if (!db) return; // Prevent run if db is not initialized
Â  Â  Â  Â  Â  Â  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
Â  Â  Â  Â  Â  Â  const collectionPath = `artifacts/${appId}/public/data/scores_2569`;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const scoresCollection = collection(db, collectionPath);
Â  Â  Â  Â  Â  Â  const q = query(scoresCollection);

Â  Â  Â  Â  Â  Â  onSnapshot(q, (querySnapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  allScores = [];
Â  Â  Â  Â  Â  Â  Â  Â  querySnapshot.forEach((doc) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allScores.push({ id: doc.id, ...doc.data() });
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Sort by Rank ascending (asc) in memory
Â  Â  Â  Â  Â  Â  Â  Â  allScores.sort((a, b) => (a.rank || Infinity) - (b.rank || Infinity));
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  applyFilters(); // Re-render public table with new data
Â  Â  Â  Â  Â  Â  Â  Â  if(document.getElementById('admin-section').style.display !== 'none') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderAdminTable(allScores);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, (error) => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error fetching scores: ", error);
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰", "error");
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // Filter and render the public results table
Â  Â  Â  Â  function applyFilters() {
Â  Â  Â  Â  Â  Â  const curriculum = filterCurriculum.value;
Â  Â  Â  Â  Â  Â  const examType = filterExamType.value;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const filteredScores = allScores.filter(score => {
Â  Â  Â  Â  Â  Â  Â  Â  const curriculumMatch = curriculum === 'all' || score.curriculum === curriculum;
Â  Â  Â  Â  Â  Â  Â  Â  const examTypeMatch = examType === 'all' || score.examType === examType;
Â  Â  Â  Â  Â  Â  Â  Â  return curriculumMatch && examTypeMatch;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  renderScoresTable(filteredScores);
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderScoresTable(scores) {
Â  Â  Â  Â  Â  Â  const tableBody = document.getElementById('results-table-body');
Â  Â  Â  Â  Â  Â  if (scores.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  tableBody.innerHTML = `<tr><td colspan="5" class="text-center py-6 text-gray-500">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¸«à¸£à¸±à¸šà¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸</td></tr>`;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  tableBody.innerHTML = scores.map(score => `
Â  Â  Â  Â  Â  Â  Â  Â  <tr class="bg-white border-b hover:bg-gray-50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 font-bold text-gray-900">${score.rank}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">${score.nickname}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">${score.curriculum}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4"><span class="px-2 py-1 text-xs font-medium rounded-full ${score.examType === 'On-site' ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800'}">${score.examType}</span></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 text-right font-bold text-blue-600">${(score.totalScore || 0).toFixed(2)}</td>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  `).join('');
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Admin Functions ---
Â  Â  Â  Â  document.getElementById('admin-login').addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  customPrompt("à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥à¸£à¸°à¸šà¸š:", (password) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (password === adminPassword) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥à¸£à¸°à¸šà¸šà¸ªà¸³à¹€à¸£à¹‡à¸ˆ", "success");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switchView('admin'); 
Â  Â  Â  Â  Â  Â  Â  Â  } else if (password !== null) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡", "error");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  function renderAdminTable(scores) {
Â  Â  Â  Â  Â  Â  const tableHead = document.getElementById('admin-table-head');
Â  Â  Â  Â  Â  Â  const tableBody = document.getElementById('admin-table-body');

Â  Â  Â  Â  Â  Â  // à¹ƒà¸Šà¹‰à¸Šà¸¸à¸”à¸§à¸´à¸Šà¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰ Header à¸„à¸£à¸­à¸šà¸„à¸¥à¸¸à¸¡à¸—à¸¸à¸à¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  tableHead.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-3 px-4">Rank</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-3 px-4">Nickname</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-3 px-4">Curriculum</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-3 px-4">Type</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${allSubjects.map(s => `<th class="py-3 px-4 text-right">${s}</th>`).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-3 px-4 text-right">Total</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-3 px-4">Time Stamp</th>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>`;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  tableBody.innerHTML = scores.map(score => {
Â  Â  Â  Â  Â  Â  Â  Â  const date = score.createdAt && score.createdAt.toDate ? score.createdAt.toDate() : (score.createdAt.seconds ? new Date(score.createdAt.seconds * 1000) : new Date());
Â  Â  Â  Â  Â  Â  Â  Â  const timestamp = date.toLocaleString('th-TH');
Â  Â  Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr class="bg-white border-b">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">${score.rank}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">${score.nickname}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">${score.curriculum}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">${score.examType}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${allSubjects.map(s => `<td class="py-3 px-4 text-right">${(score.scores && score.scores[s] !== undefined) ? score.scores[s].toFixed(2) : '-'}</td>`).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 text-right font-bold">${(score.totalScore || 0).toFixed(2)}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 text-xs">${timestamp}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }).join('');
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function exportToCSV() {
Â  Â  Â  Â  Â  Â  let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; // \uFEFF for BOM (Thai compatibility)
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const headers = ["Rank", "Nickname", "Curriculum", "ExamType", ...allSubjects, "TotalScore", "Timestamp"];
Â  Â  Â  Â  Â  Â  csvContent += headers.join(",") + "\r\n";
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  allScores.forEach(score => {
Â  Â  Â  Â  Â  Â  Â  Â  const date = score.createdAt.toDate ? score.createdAt.toDate() : (score.createdAt.seconds ? new Date(score.createdAt.seconds * 1000) : new Date());
Â  Â  Â  Â  Â  Â  Â  Â  const timestamp = date.toLocaleString('th-TH');
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const row = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  score.rank,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `"${score.nickname.replace(/"/g, '""')}"`, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  score.curriculum,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  score.examType,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...allSubjects.map(s => (score.scores && score.scores[s] !== undefined) ? score.scores[s] : '0'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  score.totalScore,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `"${timestamp}"`
Â  Â  Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  Â  Â  csvContent += row.join(",") + "\r\n";
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const encodedUri = encodeURI(csvContent);
Â  Â  Â  Â  Â  Â  const link = document.createElement("a");
Â  Â  Â  Â  Â  Â  link.setAttribute("href", encodedUri);
Â  Â  Â  Â  Â  Â  link.setAttribute("download", "pretest_scores_2569.csv");
Â  Â  Â  Â  Â  Â  document.body.appendChild(link);
Â  Â  Â  Â  Â  Â  link.click();
Â  Â  Â  Â  Â  Â  document.body.removeChild(link);
Â  Â  Â  Â  Â  Â  showMessage("à¸ªà¹ˆà¸‡à¸­à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸›à¹‡à¸™ CSV à¸ªà¸³à¹€à¸£à¹‡à¸ˆ", "success");
Â  Â  Â  Â  }

Â  Â  Â  Â  document.getElementById('export-csv').addEventListener('click', exportToCSV);


Â  Â  Â  Â  // --- Helper Functions ---
Â  Â  Â  Â  function showMessage(message, type = 'success') {
Â  Â  Â  Â  Â  Â  const box = document.getElementById('message-box');
Â  Â  Â  Â  Â  Â  const colors = { success: 'green', error: 'red', warning: 'yellow' };
Â  Â  Â  Â  Â  Â  const icons = { success: 'fa-check-circle', error: 'fa-times-circle', warning: 'fa-exclamation-triangle' };
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const alertDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  alertDiv.className = `p-4 rounded-lg shadow-lg mb-2 bg-${colors[type]}-100 border-l-4 border-${colors[type]}-500 text-${colors[type]}-800 transition-all duration-300 transform translate-x-full opacity-0`;
Â  Â  Â  Â  Â  Â  alertDiv.innerHTML = `<i class="fas ${icons[type]} mr-2"></i> <span class="font-semibold">${message}</span>`;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  box.prepend(alertDiv);
Â  Â  Â  Â  Â  Â  setTimeout(() => alertDiv.classList.remove('translate-x-full', 'opacity-0'), 10);
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  alertDiv.classList.add('opacity-0');
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => alertDiv.remove(), 400);
Â  Â  Â  Â  Â  Â  }, 4000);
Â  Â  Â  Â  }

Â  Â  Â  Â  function toggleLoading(show) {
Â  Â  Â  Â  Â  Â  document.getElementById('loading-overlay').classList.toggle('hidden', !show);
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Event Listeners ---
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  initializeFirebase();
Â  Â  Â  Â  Â  Â  updateScoreInputs(); // Initial setup for score fields
Â  Â  Â  Â  });
Â  Â  Â  Â  curriculumSelect.addEventListener('change', updateScoreInputs);
Â  Â  Â  Â  form.addEventListener('submit', handleFormSubmit);
Â  Â  Â  Â  filterCurriculum.addEventListener('change', applyFilters);
Â  Â  Â  Â  filterExamType.addEventListener('change', applyFilters);

Â  Â  </script>
</body>
</html>
